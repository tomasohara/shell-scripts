## SETUP (OPTIONAL - USE IF REQUIRED)
## Bracketed Paste is disabled to prevent characters after output
## Example: 
## $ echo 'Hii'
## | Hi?2004l
# bind 'set enable-bracketed-paste off'

## TEST:  Make sure simple prompt used (e.g., no escapes that might contaminate output)
## PS1="$ "
## TODO: PS1="> "
## NOTE: The Jupyter bash kernel requires that PS1 not be modified as they customize it. 
$ echo $PS1
[PEXP\[\]ECT_PROMPT>

# Delete all aliases and function
# TODO: Instead start from pristine environment
$ unalias -a
$ alias | wc -l
$ for f in $(typeset -f | egrep '^\w+'); do unset -f $f; done
$ typeset -f | egrep '^\w+' | wc -l
0
0

## NOTE: All directory references should be standard directories
## (e.g., /home/xaea12/bin => /tmp/test-alias/bin). 
## In addition, avoid using personal directories to help weed out local usages
## OLD: AVEE_BIN=/home/xaea12/bin
# SPECIFYING AN IDENTIFIER FOR TMP
## OLD: TMP=temp/tmp
$ TMP=/tmp/test-dir-aliases
## NOTE: Source it directly from the ./tests directory.
$ BIN_DIR=$PWD/..
## You will need to run jupyter from that directory.
## source $TEMP_BIN/_dir-aliases.bash
$ source _dir-aliases.bash
$ alias | wc -l
8

# Count aliases proper
$ alias | wc -l
8

# Count functions
$ typeset -f | egrep '^\w+' | wc -l
2

## NOTE: For reproducability, the directory name needs to be fixed
## In place of $$, use a psuedo random number (e,g., 7919)
## *** All output from one run to the next needs to be the same ***
# Test safe symbolic links
## temp_dir=$TMP/test-$$
$ temp_dir=$TMP/test-7919
$ mkdir -p "$temp_dir"
# TODO: /bin/rm -rvf "$temp_dir"
$ cd "$temp_dir"
$ pwd
/tmp/test-dir-aliases/test-7919

# Clean up temp dir
#
# NOTE: To place it safe, the directory path is reproduced here.
# IN addition, the output is omitted.
## OLD: /bin/rm -rvf "$temp_dir"/*
$ /bin/rm -rvf /tmp/test-dir-aliases/test-7919/* >| /tmp/_cleanup-test-dir-aliases.log 2>&1

# The first case succeed
$ touch file1
$ ln-symbolic file1 link1
# 'link1' -> 'file1'
# The second case should should fail
$ ln-symbolic file1 link1
# => "ln: failed to create symbolic link 'link1': File exists?"
# Should only be four files total (along with . and ..)
$ ls -R | wc -l
# => 3
'link1' -> 'file1'
ln: failed to create symbolic link 'link1': File exists
3

# FYI: the current aliases and functions
## OLD: cat $AVEE_BIN/_dir-aliases.bash
## ERROR PRONE COMMAND (BATSPP) - WORKS FINE
# cat $BIN_DIR/tests/_dir-aliases.bash
## TODO: convert this to inline comments (to avoid clutter in the output)

$ bash $BIN_DIR/tests/_dir-aliases.bash

## Note: to make reproducible, only show pemrissions and the file info shown at end,
## omitting details like the user and time that could be different.
##
## $ cd test-7919
## /tmp/test-dir-aliases/test-7919
##
## $ ls -l
## total 0
## -rw-rw-r-- 1 tomohara tomohara 0 Jun 12 18:48 file1
## lrwxrwxrwx 1 tomohara tomohara 5 Jun 12 18:48 link1 -> file1
##
## $ echo 123456789-123456789-123456789-123456789-123456789-123456789-123456789-
## 123456789-123456789-123456789-123456789-123456789-123456789-123456789-
##
## # ls -l | cut --characters=12-46 --complement
## total 0
## -rw-rw-r-- file1
## lrwxrwxrwx link1 -> file1
## OLD: ls -l
$ ls -l | cut --characters=12-46 --complement
total 0
-rw-rw-r-- 
lrwxrwxrwx -> file1

$ ln-symbolic /tmp temp-link
'temp-link' -> '/tmp'

## OLD: ls -l
$ ls -l | cut --characters=12-46 --complement
total 0
-rw-rw-r-- 
lrwxrwxrwx -> file1
lrwxrwxrwx ink -> /tmp

$ link-symbolic-safe --force /tmp/tmp temp-link
'temp-link' -> '/tmp/tmp'

## OLD: ls -l
$ ls -l | cut --characters=12-46 --complement
total 0
-rw-rw-r-- 
lrwxrwxrwx -> file1
lrwxrwxrwx ink -> /tmp/tmp

$ alias ln-symbolic-force='ln-symbolic --force'

# # SINCE temp-link EXISTS, THE COMMAND FAILS
# $ ln-symbolic /tmp temp-link
# | ln: failed to create symbolic link 'temp-link': File exists

$ ln-symbolic-force /tmp temp-link
'temp-link' -> '/tmp'

$ link-symbolic-safe --force /tmp/tmp temp-link
'temp-link' -> '/tmp/tmp'

## OLD: ls -l
$ ls -l | cut --characters=12-46 --complement
total 0
-rw-rw-r-- 
lrwxrwxrwx -> file1
lrwxrwxrwx ink -> /tmp/tmp
